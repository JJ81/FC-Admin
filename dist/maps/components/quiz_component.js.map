{"version":3,"sources":["components/quiz_component.js"],"names":["define","Util","QuizComponent","options","data","this","extendOptions","extendData","isNew","item","prototype","a","b","extend","key","hasOwnProperty","setData","question","el","querySelector","value","answer_desc","querySelectorAll","correct_options","quiz_id","type","quiz_type","option_group_id","index","order","length","id","push","optionId","opt_id","option","checked","iscorrect","init","create_quiz","answer","create_quiz_options","create_quiz_events","create_option_events","show","btn_remove","e","preventDefault","remove","btn_add_option","input_add_option","addEventListener","which","keyCode","bind","wrapper","appendChild","focus","delete","input_question","removeChild","parent","removeQuiz","validate","i","nodes","correct_checked","alert","document","createElement","className","innerstr","option_box","_self","onclick","classList","option_id","$","target","closest","setAttribute","deleteQuizOption","parentNode","innerHTML","setIndex","new_index"],"mappings":"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","file":"components/quiz_component.js","sourcesContent":["\n'use strict';\ndefine(['common'], function (Util) {\n  /**\n   * QuizComponent 생성자\n   * @param {object} options - The options object\n   * @reference - https://gist.github.com/jonnyreeves/2474026\n   */\n  function QuizComponent (options, data) {\n    this.extendOptions(options);\n    this.extendData(data);\n    this.isNew = (data.quiz_id === null);\n    this.init();\n  }\n\n  /**\n   * Prototype\n   *\n   */\n  QuizComponent.prototype = {\n    options: {},\n    data: {},\n    extend: function (a, b) {\n      for (var key in b) {\n        if (b.hasOwnProperty(key)) {\n          a[key] = b[key];\n        }\n      }\n      return a;\n    },\n    // 옵션을 확장한다.\n    extendOptions: function (options) {\n      this.options = this.extend({}, this.options);\n      this.extend(this.options, options);\n    },\n    // 데이터를 확장한다.\n    extendData: function (data) {\n      this.data = this.extend({}, this.data);\n      this.extend(this.data, data);\n    },\n    // 퀴즈 데이터를 생성한다.\n    setData: function () {\n            // console.info('save');\n\n      var question = this.el.querySelector('#question').value,\n        answer_desc = this.el.querySelector('#answer_desc'),\n        options = this.el.querySelectorAll('.options'),\n        correct_options = this.el.querySelectorAll('.correct-checkbox');\n\n      answer_desc = answer_desc ? answer_desc.value : null;\n\n      if (this.isNew) {\n        this.data = {\n          quiz_id: null,\n          type: this.data.type,\n          quiz_type: this.data.quiz_type,\n          question: question,\n          answer_desc: answer_desc,\n          option_group_id: this.data.option_group_id,\n          order: this.options.index,\n          options: [] // 보기\n        };\n      } else {\n        this.data.question = question;\n        this.data.answer_desc = answer_desc;\n        this.data.order = this.options.index;\n        this.data.options = [];\n      }\n\n      if (options.length) {\n        for (var index = 0; index < options.length; index++) {\n          this.data.options.push({\n            id: options[index].dataset.optionId,\n            opt_id: this.data.option_group_id,\n            option: options[index].value,\n            iscorrect: correct_options[index].checked ? 1 : 0,\n            order: index\n          });\n        }\n      }\n    },\n    init: function () {\n      this.create_quiz();\n      if (this.data.quiz_id) {\n        this.el.querySelector('#question').value = this.data.question;\n\n        switch (this.data.quiz_type) {\n        case 'A': // 단답형\n          this.el.querySelector('#answer_desc').value = this.data.answer;\n          break;\n        case 'B': // 선택형\n        case 'C': // 다답형\n          for (var index = 0; index < this.data.options.length; index++) {\n            var data = this.data.options[index];\n            this.create_quiz_options(data);\n          }\n          break;\n\n        default:\n          break;\n        }\n      }\n\n      this.create_quiz_events();\n      this.create_option_events();\n      this.show();\n    },\n    // 퀴즈의 기본 이벤트를 생성한다.\n    create_quiz_events: function () {\n            // console.info('create_events');\n\n            // 퀴즈 수정모드에서만 사용가능 (deprecated)\n            // if (this.data.quiz_id) {\n            //     var btn_save = this.el.querySelector('.btn-save-quiz');\n            //     btn_save.addEventListener( \"click\", function(e) {\n            //         e.preventDefault();\n            //         // this.save();\n            //     }.bind(this));\n            // }\n\n      var btn_remove = this.el.querySelector('.btn-remove-quiz');\n\n            // 퀴즈 삭제\n      btn_remove.addEventListener('click', function (e) {\n        e.preventDefault();\n        this.remove();\n      }.bind(this));\n    },\n    // 선택형, 다답형일 경우 이벤트를 생성한다.\n    create_option_events: function () {\n      if (this.data.quiz_type !== 'A') {\n        var btn_add_option = this.el.querySelector('#btn-add-option');\n        var input_add_option = this.el.querySelector('#input-add-option');\n        var btn_remove_option = this.el.querySelector('.btn_remove_option');\n        var option_box = this.el.querySelector('#option-box');\n\n                // 보기 추가 (엔터키 입력시)\n        input_add_option.addEventListener('keypress', function (e) {\n          var key = e.which || e.keyCode;\n\n          if (key === 13 && input_add_option.value) {\n            this.create_quiz_options();\n          }\n        }.bind(this));\n\n                // 보기 추가 ( + 버튼 클릭시)\n        btn_add_option.addEventListener('click', function (e) {\n          e.preventDefault();\n\n          if (input_add_option.value) { this.create_quiz_options(); }\n        }.bind(this));\n      }\n    },\n    // 퀴즈를 보여준다.\n    show: function () {\n      this.options.wrapper.appendChild(this.el);\n      var input_question = this.el.querySelector('#question');\n      input_question.focus();\n    },\n    // 퀴즈를 DB 에서 삭제한다.\n    delete: function () {\n      this.options.wrapper.removeChild(this.el);\n    },\n    // 퀴즈를 삭제한다.\n    remove: function () {\n      this.options.parent.removeQuiz(this);\n    },\n        // 저장 전 유효성 검사\n    validate: function () {\n      // 빈칸여부 확인\n      var nodes = this.el.querySelectorAll('input[type=text]:not(#input-add-option)');\n      var i;\n      var correct_checked = 0; // 정답체크한 보기의 수\n\n      if (this.data.quiz_type !== 'A' && nodes.length <= 2) {\n        alert('보기를 2개 이상 입력해주세요.');\n        return false;\n      }\n\n      for (i = 0; i < nodes.length; i++) {\n        if (nodes[i].value == '') {\n          alert('빈칸은 모두 입력해주세요.');\n          nodes[i].focus();\n          return false;\n        }\n      }\n\n      // 단답형이 아닐 경우에만 정답체크여부 확인\n      if (this.data.quiz_type !== 'A') {\n        nodes = this.el.querySelectorAll('.correct-checkbox');\n        for (i = 0; i < nodes.length; i++) {\n          if (nodes[i].checked) {\n            correct_checked++;\n          }\n        }\n\n        if (!correct_checked) {\n          alert('정답을 체크해주세요.');\n          return false;\n        }\n      }\n\n      return true;\n    },\n    // 퀴즈를 생성한다.\n    create_quiz: function () {\n            // console.info('create_element');\n\n      this.el = document.createElement('div');\n      this.el.className = 'box box-success';\n\n      var innerstr = '';\n            // box header\n      innerstr += '   <div class=\"box-header\" data-index=\"' + this.options.index + '\">';\n      innerstr += '       <i class=\"fa fa-quora\"></i>';\n      innerstr += '       <h3 class=\"box-title\">' + (this.options.index + 1) + '번 문제</h3>';\n      innerstr += '       <div class=\"box-tools pull-right\" data-toggle=\"tooltip\" title=\"\" data-original-title=\"Status\">';\n      innerstr += '           <div class=\"btn-group\" data-toggle=\"btn-toggle\">';\n            // if (this.options.quiz_id) {\n            // innerstr += '               <button type=\"sumit\" class=\"btn btn-default btn-sm btn-save-quiz\">';\n            // innerstr += '                   <i class=\"fa fa-save\">  저장</i>';\n            // innerstr += '               </button>';\n            // }\n      innerstr += '               <button type=\"button\" class=\"btn btn-default btn-sm btn-remove-quiz\" data-widget=\"remove\">';\n      innerstr += '                   <i class=\"fa fa-times\">  삭제</i>';\n      innerstr += '               </button>';\n      innerstr += '           </div>';\n      innerstr += '       </div>';\n      innerstr += '   </div>';\n\n            // A: 단답형, B: 선택형, C: 다답형\n      if (this.data.quiz_type === 'A') {\n        innerstr += '   <div class=\"box-body\">';\n        innerstr += '       <div class=\"form-group\">';\n        innerstr += '           <input type=\"text\" class=\"form-control\" name=\"question\" id=\"question\" placeholder=\"질문을 입력하세요\" required autocomplete=\"off\" />';\n        innerstr += '       </div>';\n        innerstr += '       <div class=\"form-group\">';\n        innerstr += '           <input type=\"text\" class=\"form-control\" name=\"answer_desc\" id=\"answer_desc\" placeholder=\"답변을 입력하세요\" required autocomplete=\"off\" />';\n        innerstr += '       </div>';\n        innerstr += '   </div>';\n      } else {\n        innerstr += '   <div class=\"box-body\">';\n        innerstr += '       <div class=\"form-group\">';\n        innerstr += '           <input type=\"text\" class=\"form-control\" name=\"question\" id=\"question\" placeholder=\"질문을 입력하세요\" required autocomplete=\"off\" />';\n        innerstr += '       </div>';\n        innerstr += '       <div id=\"option-box\">';\n        innerstr += '       </div>';\n        innerstr += '   </div>';\n\n        innerstr += '   <div class=\"box-footer clearfix\">';\n        innerstr += '       <div class=\"input-group\">';\n        innerstr += '           <input id=\"input-add-option\" class=\"form-control\" placeholder=\"추가할 보기 내용을 입력하세요\">';\n        innerstr += '           <div class=\"input-group-btn\">';\n        innerstr += '               <button id=\"btn-add-option\" type=\"button\" class=\"btn btn-default\"><i class=\"fa fa-plus\"></i></button>';\n        innerstr += '           </div>';\n        innerstr += '       </div>';\n        innerstr += '   </div>';\n      }\n\n            // create html\n      this.el.innerHTML = innerstr;\n    },\n    // 퀴즈의 보기를 생성한다.\n    create_quiz_options: function (data) {\n            // console.info('create_element_options');\n            // console.log(data);\n\n      var option_box = this.el.querySelector('#option-box');\n      var item = document.createElement('div');\n      var input_add_option = this.el.querySelector('#input-add-option');\n      var _self = this;\n\n      item.className = 'item';\n\n      if (data) { item.setAttribute('data-option-id', data.id); }\n\n      item.onclick = function (e) {\n        if (e.target.classList[2] == 'btn-remove-option') {\n          if (data) {\n            var option_id = $(e.target).closest('.item').data('option-id');\n            _self.options.parent.deleteQuizOption(option_id, function () {\n              this.parentNode.removeChild(this);\n            }.bind(this));\n          } else {\n            this.parentNode.removeChild(this);\n          }\n        }\n      };\n\n      var innerstr = '';\n      innerstr += '<div class=\"form-group\">';\n      innerstr += '   <div class=\"input-group\">';\n      innerstr += '       <span class=\"input-group-addon\">';\n\n            // B: 선택형, C: 다답형\n      if (data) {\n        if (this.data.quiz_type === 'B') { innerstr += '           <input name=\"radio-group-' + this.options.index + '\" class=\"correct-checkbox\" type=\"radio\" ' + (data.iscorrect === 1 ? 'checked' : '') + ' />'; } else { innerstr += '           <input type=\"checkbox\" class=\"correct-checkbox\" ' + (data.iscorrect === 1 ? 'checked' : '') + ' />'; }\n        innerstr += '       </span>';\n        innerstr += '       <div class=\"input-group\" style=\"width: 100%\">';\n        innerstr += '           <input type=\"text\" class=\"form-control options\" required autocomplete=\"off\" placeholder=\"보기를 입력하세요\" data-option-id=\"' + data.id + '\" value=\"' + data.option + '\" />';\n      } else {\n        if (this.data.quiz_type === 'B') { innerstr += '           <input name=\"radio-group-' + this.options.index + '\" class=\"correct-checkbox\" type=\"radio\" />'; } else { innerstr += '           <input type=\"checkbox\" class=\"correct-checkbox\" />'; }\n        innerstr += '       </span>';\n        innerstr += '       <div class=\"input-group\" style=\"width: 100%\">';\n        innerstr += '           <input type=\"text\" class=\"form-control options\" required autocomplete=\"off\" placeholder=\"보기를 입력하세요\" value=\"' + input_add_option.value + '\" />';\n      }\n\n      innerstr += '           <div class=\"input-group-btn btn-remove-option\">';\n      innerstr += '               <button id=\"btn-remove-option\" type=\"button\" class=\"btn btn-danger btn-remove-option\"><i class=\"fa fa-minus btn-remove-option\"></i></button>';\n      innerstr += '           </div>';\n      innerstr += '       </div>';\n      innerstr += '    </div>';\n      innerstr += '</div>';\n\n      item.innerHTML = innerstr;\n      option_box.appendChild(item);\n\n      input_add_option.value = '';\n    },\n    // 인덱스를 변경한다.\n    setIndex: function (new_index) {\n      this.options.index = new_index;\n      var header = this.el.querySelector('.box-header');\n      var title = this.el.querySelector('.box-title');\n      header.setAttribute('data-index', new_index + 1);\n      title.innerHTML = (new_index + 1) + '번 문제';\n    }\n  };\n\n  return QuizComponent;\n});\n"],"sourceRoot":"/source/"}