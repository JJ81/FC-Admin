"use strict";window.requirejs(["common","text!../course.template.html","text!../session.template.html"],function(e,t,n){function i(){window.axios.get("/simple_assignment/courses",{params:{edu_id:Y("#edu_id").val()}}).then(function(e){var t=e.data.courses;if(t.length>0){var n=Y("#js--formAddCourse").find("#table_courses").DataTable();n.clear().draw(),n.rows.add(t),n.columns.adjust().draw()}}).catch(function(e){console.error(e)})}function a(){var e=Y(":checkbox:checked",W.rows().nodes()).map(function(){return Y(this).data("id")}).get().join(", ");Y("input[name='upload_employee_ids']").val(e)}function o(){var e=0;return Y(".point-item").each(function(){Y(this).parent().find(".input-group-addon").children("input:checkbox").prop("checked")&&""!==Y(this).val()&&(e+=parseInt(Y(this).val()))}),Y(".badge").text(e),e}function d(e){var t=Y(".panel-group").data("selected-course-id"),n=Y(".panel[data-id="+t+"]");(void 0===n.data("metadata").sessionLoaded||e)&&window.axios.get("/course/"+t).then(function(e){e.data&&(n.find(".session-content").html(_({session_list:e.data.session_list})),n.data("metadata").sessionLoaded=!0,Y(".list-group").sortable({connectWith:".list-group-item",start:function(e,t){Y(this).attr("data-previndex",t.item.index())},update:function(e,t){Y(this).removeAttr("data-previndex"),g()}}).disableSelection())}).catch(function(e){console.log(e)})}function s(){var e=Y("#edu_id").val();Y("#course-list").empty(),window.axios.get("/education/"+e+"/courses").then(function(e){e.data&&(Y.each(e.data.edu_course_list,function(e,t){Y("#course-list").append(w(t)),Y(".panel").last().data("metadata",t)}),Y("#course-list").sortable({connectWith:".panel",start:function(e,t){Y(this).attr("data-previndex",t.item.index())},update:function(e,t){Y(this).removeAttr("data-previndex"),k()}}).disableSelection())}).catch(function(e){console.log(e)})}function c(e){window.axios.get("/education/"+e+"/pointweight").then(function(e){if(e.data){var t=e.data.education[0];if(Y("input[name='course_name']").val(t.name),window.tinymce.activeEditor.setContent(""),window.tinymce.get("input-course-desc").setContent(t.desc),Y("input[name='complete_point']").val(t.point_complete),Y("input[name='quiz_point']").val(t.point_quiz),Y("input[name='test_point']").val(t.point_final),Y("input[name='reeltime_point']").val(t.point_reeltime),Y("input[name='reps_point']").val(t.point_repetition),Y("input[name='speed_point']").val(t.point_speed),Y("#can-replay").prop("checked",1===t.can_replay),Y("#edu_id").val(t.id),Y("#edu_id").data("existed","Y"),o(),e.data.tags)for(var n in e.data.tags)Y("#eduTags").tagit("createTag",e.data.tags[n].name);s(),Y("#addEdu").modal("hide")}}).catch(function(e){console.log(e)})}function r(e){var t="ul.setup-panel li:eq("+(parseInt(e)-1)+")",n='ul.setup-panel li a[href="#step-'+e+'"]';Y(t).removeClass("disabled"),Y(n).trigger("click")}function u(e){if(4===z&&4===e)return r(e),!1;window.axios.post("/simple_assignment/progress",{step:e,id:q}).then(function(t){return r(e),!0}).catch(function(e){return console.log(e),!1})}function l(){P.prop("disabled",!0);var e=new window.FormData;e.append("upload_type",Y("input[name='upload_type']").val()),e.append("upload_employee_ids",Y("input[name='upload_employee_ids']").val()),e.append("file-excel",document.getElementById("UploadExcelFile").files[0]),e.append("group_name","간편배정"),e.append("redirect",!1),e.append("id",q),e.append("log_bind_user_id",Y("#log_bind_user_id").val()),e.append("edu_id",Y("#edu_id").val()),e.append("start_dt",Y("input[name='start_dt']").val()),e.append("finish_dt",Y("input[name='finish_dt']").val()),e.append("training_edu_id",Y("#training_edu_id").val()),window.axios.post("/assignment/upload",e).then(function(e){e.data&&(P.prop("disabled",!1),!1!==e.data.success?(Y("#log_bind_user_id").val(e.data.logBindUserId),window.alert("교육생을 저장하였습니다.")):(window.alert("교육생을 저장하지 못하였습니다."),console.log(e.data.message)))}).catch(function(e){console.log(e)})}function p(){var e={name:Y("input[name='course_name']").val(),desc:window.tinymce.get("input-course-desc").getContent({format:"raw"}),complete_point:Y("input[name='complete_point']").val(),quiz_point:Y("input[name='quiz_point']").val(),test_point:Y("input[name='test_point']").val(),reeltime_point:Y("input[name='reeltime_point']").val(),speed_point:Y("input[name='speed_point']").val(),reps_point:Y("input[name='reps_point']").val(),start_dt:Y("input[name='start_dt']").val(),finish_dt:Y("input[name='finish_dt']").val(),assigment_id:q,upload_employee_ids:Y("input[name='upload_employee_ids']").val(),edu_id:Y("#edu_id").val(),edu_tags:Y("#eduTags").tagit("assignedTags"),is_existed_edu:Y("#edu_id").data("existed"),log_bind_user_id:Y("#log_bind_user_id").val(),training_edu_id:Y("#training_edu_id").val(),can_replay:Y("#can-replay").prop("checked")?0:1,can_advance:Y("#can-advance").prop("checked")?0:1};window.axios.post("/education",e).then(function(e){e.data&&(Y("#training_edu_id").val(e.data.trainingEduId),Y("#edu_id").val(e.data.eduId),window.alert("교육과정을 저장하였습니다."))}).catch(function(e){console.log(e)})}function f(){if(!window.confirm("정말 삭제하시겠습니까?"))return!1;var e={id:q,log_bind_user_id:Y("#log_bind_user_id").val(),edu_id:Y("#edu_id").val()};window.axios.delete("/simple_assignment",{params:e}).then(function(e){e.data.success?(window.alert("교육과정을 삭제하였습니다."),window.location.href="/simple_assignment"):window.alert("배정내역을 삭제하지 못하였습니다.")}).catch(function(e){console.log(e)})}function m(){var e=Y("ul.select-employee li.active").children().attr("id"),t=null;switch(Y("input[name='upload_type']").val(e),e){case"employee":if(!(t=Y(":checkbox:checked",W.rows().nodes()).map(function(){return Y(this).data("id")}).get().join(", ")))return window.alert("직원을 선택하세요."),!1;Y("input[name='upload_employee_ids']").val(t);break;case"excel":if(0===document.getElementById("UploadExcelFile").files.length)return Y("#UploadExcelFile").focus(),window.alert("파일을 선택하세요."),!1}return!0}function h(){var e=Y("input[name='course_name']"),t=Y("#input-course-desc").val();if(""===e.val())return window.alert("교육과정명을 입력하세요."),e.focus(),!1;if(""===t)return window.alert("교육과정에 대한 설명을 입력하세요."),window.tinymce.execCommand("mceFocus",!1,"input-course-desc"),!1;var n=!0,i=0;if(Y(".point-item").each(function(){if(Y(this).parent().find(".input-group-addon").children("input:checkbox").prop("checked")){if(""===Y(this).val())return window.alert(Y(this).prop("placeholder")+" 포인트 점수를 입력하세요."),Y(this).focus(),n=!1,!1;i+=parseInt(Y(this).val())}}),!n)return!1;if(100!==i)return window.alert("포인트의 합계는 100점이 되어야 합니다."),!1;var a=Y("input[name='start_dt']").val(),o=Y("input[name='finish_dt']").val();return a?!!o||(window.alert("종료일자를 선택하세요."),Y("input[name='finish_dt']").focus(),!1):(window.alert("시작일자를 선택하세요."),Y("input[name='start_dt']").focus(),!1)}function w(e){return Q(e)}function _(e){return S(e)}function v(e){return window.axios({method:"put",url:"/course/courselist",data:{title:e.children("a").data("title"),course_list_id:e.children("a").data("id"),course_list_order:e.index()}})}function g(){for(var e=[],t=window.$(".session-content > .list-group-item"),n=0;n<t.length;n++)e.push(v(window.$(t[n])));window.axios.all(e).then(window.axios.spread(function(e,t){e.data.success&&window.alert("세션순서를 변경하였습니다.")}))}function b(e){return window.axios({method:"put",url:"/education/coursegroup",data:{id:e.data("group-id"),order:e.index()}})}function k(){for(var e=[],t=Y("#course-list > .panel"),n=0;n<t.length;n++)e.push(b(window.$(t[n])));window.axios.all(e).then(window.axios.spread(function(e,t){e.data.success&&window.alert("강의순서를 변경하였습니다.")}))}function y(e){Y(e.target).prev(".panel-heading").find(".more-less").toggleClass("glyphicon-plus glyphicon-minus");var t=Y(e.target).parents().find(".panel-group"),n=Y(e.target).parents().closest(".panel").data("id");t.data("selected-course-id")!==n&&(t.data("selected-course-id",n),d())}function x(){var e=Y("#registerCourse"),t={course_name:e.find("input[name='course_name']").val(),course_desc:window.tinymce.activeEditor.getContent(),teacher_name:e.find("input[name='teacher_name']").val(),edu_id:Y("#edu_id").val()};window.axios.post("/course",t).then(function(e){if(e.data){if(0===Y("#course-list").children().length){Y("ul.setup-panel li:eq(3)").removeClass("disabled"),u(4)}Y("#course-list").append(w(e.data)),Y(".panel").last().data("metadata",e.data)}}).catch(function(e){console.log(e)})}function C(){var e=Y("#modifyCourse"),t=Y(".panel-group").data("selected-course-id"),n={course_id:t,course_name:e.find("input[name='course_name']").val(),course_desc:window.tinymce.activeEditor.getContent(),teacher_name:e.find("input[name='teacher_name']").val(),course_rate:0,teacher_rate:0};window.axios.put("/course",n).then(function(e){e.data&&(Y(".panel[data-id="+e.data.course_id+"]").replaceWith(w(e.data)),Y(".panel[data-id="+e.data.course_id+"]").data("metadata",e.data))}).catch(function(e){console.log(e)})}function D(e){var t=Y(e.relatedTarget).parents().closest(".panel").data("metadata"),n=Y(this);n.find("input").val("").end(),window.tinymce.activeEditor.setContent(""),n.find("input[name='course_name']").val(t.course_name),n.find("input[name='teacher_name']").val(t.teacher_name),window.tinymce.get("course_desc").setContent(t.course_desc),n.find("[autofocus]").focus()}var Y=window.$,E=window._,q=Y("#assignment_id").val(),z=Y("#activated_step").val(),I=Y("ul.setup-panel li a"),T=Y(".setup-content"),$=Y("#addCourse"),H=Y("#check-all"),M=Y("#js--formAddCourse").find("#check-all"),W=e.initDataTable(Y("#table_employee"),{lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"전체"]]}),j=e.initDataTable(Y("#js--formAddCourse").find("#table_courses"),{columns:[{data:null,defaultContent:'<input type="checkbox",value="">'},{data:"course_name",className:"center"},{data:"teacher_name",className:"center"},{data:"course_id",className:"center",visible:!1}],lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"전체"]],buttons:[]}),A=e.initDataTable(Y("#js--formAddEdu").find("#table_edu"),{lengthMenu:[[5,10,25,50,-1],[5,10,25,50,"전체"]],buttons:[]}),F=Y("#js-delete-simple-assign"),P=Y("#js-save-simple-assign"),L=Y(".btn-send-message"),B=Y("#btnApplyEdu"),U=Y("#btnAttachCourses"),N=Y(".message"),Q=window.Handlebars.compile(t),S=window.Handlebars.compile(n),V="scrollbars=yes, toolbar=no, location=no, status=no, menubar=no, resizable=yes, width=1040, height=760, left=0, top=0";if(Y(function(){T.hide(),Y("#eduTags").tagit({beforeTagAdded:function(t,n){var i=n.tagLabel,a=e.getBytes(i),o=20-a;if(o<0)return console.log(o,n.tagLabel),!1}}),e.initDateTimePicker(Y(".date#start_dt"),Y(".date#finish_dt")),$.on("show.bs.modal",function(e){i()}),U.on("click",function(){var e=Y(":checkbox:checked",j.rows().nodes()).map(function(){return j.row(window.$(this).parents("tr")).data().course_id}).get().join(", ");return""===e?(window.alert("강의를 선택하세요."),!1):!!window.confirm("강의를 추가하시겠습니까?")&&(U.prop("disabled",!0),void window.axios.post("/simple_assignment/courses",{edu_id:Y("#edu_id").val(),course_ids:e}).then(function(e){e.data&&(U.prop("disabled",!1),!1!==e.data.success?(window.alert("강의를 추가하였습니다."),s(),Y("#addCourse").modal("hide")):(window.alert("강의를 추가하지 못하였습니다."),console.log(e.data.message)))}))}),Y(".education-period").click(function(){var e=Y(this),t=Y("input[name='start_dt']").val(),n=Y("#education-add-number").val();if(""===n)return!1;switch(e.data("period")){case"hour":Y("input[name='finish_dt']").val(window.moment(t).add(n,"h").format("YYYY-MM-DD HH:mm"));break;case"day":Y("input[name='finish_dt']").val(window.moment(t).add(n,"d").format("YYYY-MM-DD HH:mm"));break;case"week":Y("input[name='finish_dt']").val(window.moment(t).add(n,"w").format("YYYY-MM-DD HH:mm"));break;case"month":Y("input[name='finish_dt']").val(window.moment(t).add(n,"M").format("YYYY-MM-DD HH:mm"));break;case"year":Y("input[name='finish_dt']").val(window.moment(t).add(n,"y").format("YYYY-MM-DD HH:mm"))}}),Y("#deselect-point-items").click(function(){if(!window.confirm("점수를 초기화하시겠습니까?"))return!1;Y(".point-item").each(function(){Y(this).parent().find(".input-group-addon").children("input:checkbox").prop("checked",!1),Y(this).val(0),Y(this).prop("disabled",!0)}),o()}),Y("#select-point-items").click(function(){Y(".point-item").each(function(){Y(this).parent().find(".input-group-addon").children("input:checkbox").prop("checked",!0),Y(this).prop("disabled",!1)}),o()}),Y("ul.setup-panel li").map(function(){for(var e=Y(this),t=2;t<=z;t++)t===e.index()+1&&r(t)}),Y("#edu_id").val()&&(s(),Y("#btnGetEdu").prop("disabled",!0)),a(),o()}),window.winpop_listener=function(e){d(e)},H.bind("click",function(){Y(":checkbox",W.rows({search:"applied"}).nodes()).prop("checked",this.checked)}),M.bind("click",function(){Y(":checkbox",j.rows({search:"applied"}).nodes()).prop("checked",this.checked)}),B.bind("click",function(e){e.preventDefault();var t=Y("input:first:checked",A.rows({search:"applied"}).nodes()).data("id");void 0!==t?window.confirm("적용하시겠습니까?")&&c(t):window.alert("교육과정을 선택하세요.")}),I.click(function(e){e.preventDefault();var t=Y(Y(this).attr("href")),n=Y(this).closest("li");n.hasClass("disabled")||(I.closest("li").removeClass("active"),n.addClass("active"),T.hide(),t.show())}),z>1){var K="ul.setup-panel li a:eq("+(z-1).toString()+")";Y(K).click()}else Y("ul.setup-panel li.active a").trigger("click");Y(".step1 > .next > a").on("click",function(e){if(e.preventDefault(),m()){if(Y("#edu_id").val()){if(!window.confirm("엑셀 업로드 시 이전 배정내역은 모두 취소되며,\n배정을 취소하는 경우 학습이력이 모두 초기화 됩니다.\n그래도 계속 하시겠습니까?"))return!1}else if(!window.confirm("저장하시겠습니까?"))return!1;r(2),l()}}),Y(".step2 > .previous > a").on("click",function(e){e.preventDefault(),r(1)}),Y(".step2 > .next > a").on("click",function(e){if(e.preventDefault(),h()){if(!window.confirm("저장하시겠습니까?"))return!1;p(),r(3)}}),Y(".step3 > .previous > a").on("click",function(e){e.preventDefault(),r(2)}),Y(".step3 > .next > a").on("click",function(e){e.preventDefault(),u(4)}),Y(".step4 > .previous > a").on("click",function(e){e.preventDefault(),r(3)}),Y(".panel-collapse").on("hide.bs.collapse",function(){Y(".panel-collapse-clickable").find("i").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")}),Y(".panel-collapse").on("show.bs.collapse",function(){Y(".panel-collapse-clickable").find("i").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up")}),F.on("click",f),P.on("click",function(){var e=Y("ul.setup-panel li.active").index()+1;Y(".step"+e+" > .next > a").trigger("click")}),Y(".input-group-addon").children("input:checkbox").on("change",function(){var e=Y(this).parent().parent().find(".point-item");e.prop("disabled",!Y(this).prop("checked")),Y(this).prop("checked")&&e.focus()}),Y(".point-item").on("keyup",E.debounce(function(){var e=0;if(Y(".point-item").each(function(){if(Y(this).parent().find(".input-group-addon").children("input:checkbox").prop("checked")&&""!==Y(this).val()&&"0"!==Y(this).val()){var t=parseInt(Y(this).val());e+=t}}),e>0&&Y(".badge").text(e),e>100)return window.alert("100점을 초과하였습니다."),!1},300)),Y("#registerCourse").submit(function(e){e.preventDefault(),x(),window.tinymce.execCommand("mceFocus",!1,"course_desc"),Y(this).modal("toggle")}),Y("#modifyCourse").submit(function(e){e.preventDefault(),C(),window.tinymce.execCommand("mceFocus",!1,"course_desc"),Y(this).modal("toggle")}),Y(".panel-group").on("hidden.bs.collapse",y),Y(".panel-group").on("shown.bs.collapse",y),Y("#registerCourse").on("hidden.bs.modal",function(){Y(this).find("input").val("").end(),window.tinymce.activeEditor.setContent("")}),Y("#registerCourse").on("shown.bs.modal",function(){Y(this).find("[autofocus]").focus()}),Y("#modifyCourse").on("shown.bs.modal",D),Y(".panel-group").on("click",".btn-create-video",function(t){t.preventDefault();var n=Y(this).attr("data-course-id");e.createWindowPopup("/course/create/video?course_id="+n,"Video",V)}),Y(".panel-group").on("click",".btn-create-quiz",function(t){t.preventDefault();var n=Y(this).attr("data-course-id");e.createWindowPopup("/course/create/quiz?course_id="+n+"&type=QUIZ","Quiz",V)}),Y(".panel-group").on("click",".btn-create-final",function(t){t.preventDefault();var n=Y(this).attr("data-course-id");e.createWindowPopup("/course/create/quiz?course_id="+n+"&type=FINAL","Final",V)}),Y(".panel-group").on("click",".btn-create-checklist",function(t){t.preventDefault();var n=Y(this).attr("data-course-id");e.createWindowPopup("/course/create/checklist?course_id="+n+"&type=CHECK","Checklist",V)}),Y(".panel-group").on("click",".btn-delete-session",function(e){if(e.preventDefault(),!window.confirm("삭제 시 되돌릴 수 없습니다. 정말 삭제하시겠습니까?"))return!1;var t=Y(this),n={};switch(n.course_list_id=Y(this).parent("span").data("course-list-id"),n.course_list_type=Y(this).parent("span").data("type"),Y(this).parent("span").data("type")){case"QUIZ":case"FINAL":n.quiz_group_id=Y(this).data("quiz-group");break;case"VIDEO":n.video_id=Y(this).data("video-id");break;case"CHECKLIST":n.checklist_group_id=Y(this).data("checklist-group")}window.axios.delete("/course/courselist",{params:n}).then(function(e){e.data.success?(window.alert("세션을 삭제하였습니다."),t.parents("li").remove()):window.alert("진행한 이력이 있어 세션을 삭제하지 못했습니다. 관리자에게 문의해주시기 바랍니다.")}).catch(function(e){console.log(e)})}),Y(".panel-group").on("click",".btn-modify-session",function(t){t.preventDefault();var n=Y(this).parent("span").data("course-id"),i=Y(this).parent("span").data("course-list-id"),a=Y(this).data("video-id"),o=Y(this).data("quiz-group"),d=Y(this).data("checklist-group"),s=Y(this).parent("span").data("type");"VIDEO"===s?e.createWindowPopup("/course/modify/video?course_id="+n+"&course_list_id="+i+"&video_id="+a,"Video",V):"QUIZ"===s||"FINAL"===s?e.createWindowPopup("/course/modify/quiz?course_id="+n+"&course_list_id="+i+"&type="+s+"&quiz_group_id="+o,"Quiz",V):"CHECKLIST"===s&&e.createWindowPopup("/course/modify/checklist?course_id="+n+"&course_list_id="+i+"&type="+s+"&checklist_group_id="+d,"Checklist",V)}),Y(".panel-group").on("click",".btn-preview-checklist",function(t){t.preventDefault();var n=window.$(this).parent("span").data("course-list-id");n||(n=window.$(this).data("id")),e.createWindowPopup("/course/checklist?course_list_id="+n,"Checklist",V)}),Y(".panel-group").on("click",".btn-solve-quiz",function(t){t.preventDefault();var n=window.$(this).attr("data-quiz-group"),i=window.$(this).attr("data-title"),a=window.$(this).attr("data-type");e.createWindowPopup("/course/quiz?id="+n+"&title="+i+"&type="+a,"Quiz",V)}),Y(".panel-group").on("click",".btn-watch-video",function(t){t.preventDefault();var n=window.$(this).attr("data-video-id");e.createWindowPopup("/course/video?id="+n,"Video",V)}),Y(".panel-group").on("click",".btn-delete-course",function(){if(window.confirm("선택하신 강의를 삭제하시겠습니까?")){var e=Y(".panel-group").data("selected-course-id");window.axios.delete("/course/deactivate",{params:{id:e}}).then(function(t){t.data.success&&Y(".panel[data-id="+e+"]").remove()}).catch(function(e){console.log(e)})}}),L.on("click",function(e){e.preventDefault();var t,n=Y("ul.select-employee li.active").children().attr("id");switch(n){case"employee":t=window.$(":checkbox:checked",W.rows().nodes()).map(function(){return W.row(window.$(this).parents("tr")).data()[4]}).get().join(",")}if(!t)return window.alert("직원을 선택하세요."),!1;var i=N.val().trim();return""===i?(window.alert("메세지를 입력하세요."),N.focus(),!1):!!window.confirm("메세지를 보내시겠습니까?")&&void window.axios({method:"post",url:"/api/v1/sms/send",data:{phones:t,msg:i}}).then(function(e){!0===e.data.success?window.alert("메세지를 전송하였습니다."):window.alert("알 수 없는 오류가 발생했습니다. 잠시 후에 다시 시도해주세요.")})}),N.on("keyup",function(t){var n=window.$(t.currentTarget).val(),i=e.getBytes(n);2e3-i<0&&(window.alert("2000 Bytes 를 초과할 수 없습니다."),n=e.cutBytes(n,2e3),window.$(t.currentTarget).val(n),window.$(t.currentTarget).focus(),i=e.getBytes(n)),window.$(".remain-bytes").html(i+" / 2000 바이트")})});
//# sourceMappingURL=../maps/simple-assignment.js.map
